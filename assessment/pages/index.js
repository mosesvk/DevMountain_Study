import { useState } from 'react';
import Head from 'next/head';
import Student from '../components/Student';

export default function Home({ data }) {
  const [filterString, setFilterString] = useState('');
  const [filterTag, setFilterTag] = useState('');

  const array = data.students.map((item) => {
    item.fullName = `${item.firstName} ${item.lastName}`;
    item.tagNames = [];
    return item;
  });

  console.log(array);

  //item.tagNames.includes(filterTag);

  const filterArray = array
    .filter((item) => item.fullName.toLowerCase().includes(filterString))
    .map((item, idx) => <Student item={item} key={idx} />);

  const inputHandler = (e) => {
    setFilterString(e.target.value);
  };

  return (
    <div class='bg-gray-300 flex justify-center'>
      <Head>
        <title>Assessment - Circle Medical</title>
        <meta name='description' content='Generated by create next app' />
        <link rel='icon' href='/favicon.ico' />
      </Head>

      <div class='lg:w-1/2 mt-28'>
        <div class='bg-white flex flex-col'>
          <input
            type='text'
            placeholder='Search by Name'
            class='m-2 p-2 border-b-2 hover:border-gray-400 focus:border-gray-400 disabled:opacity-75'
            onChange={inputHandler}
          />
          <input
            type='text'
            placeholder='Search by Tag'
            class='m-2 p-2 border-b-2 hover:border-gray-400 focus:border-gray-400 disabled:opacity-75'
          />
        </div>
        <div class='bg-white h-screen overflow-auto'>{filterArray}</div>
      </div>
    </div>
  );
}

export async function getServerSideProps() {
  // Fetch data from external API
  const res = await fetch(`https://api.hatchways.io/assessment/students`);
  const data = await res.json();

  // Pass data to the page via props
  return { props: { data } };
}
